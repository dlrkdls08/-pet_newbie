import streamlit as st
import json
import numpy as np

# ---------------------------------------------------------
# ê¸°ë³¸ ì„¸íŒ…
# ---------------------------------------------------------
st.set_page_config(page_title="AI PET CARE", layout="wide")

# Session stateë¡œ í˜„ì¬ ë©”ë‰´ ê´€ë¦¬
if "menu" not in st.session_state:
    st.session_state.menu = "home"

# í™ˆí™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸° í•¨ìˆ˜
def go_home():
    st.session_state.menu = "home"

# ---------------------------------------------------------
# ë³´í—˜ ë°ì´í„° (ì˜ˆì‹œ: ì‹¤ì œ í•œêµ­ ë³´í—˜ì‚¬ ê¸°ë³¸ ë³´ì¥ ì •ë³´)
# ---------------------------------------------------------
insurance_plans = [
    {
        "íšŒì‚¬": "ì‚¼ì„±í™”ì¬ (ì• ë‹ˆí«)",
        "ë³´ì¥": "ì§ˆë³‘Â·ìƒí•´ ì§„ë£Œë¹„ì˜ 70% ë³´ì¥ (ìê¸°ë¶€ë‹´ ìˆìŒ)",
        "ìê¸°ë¶€ë‹´": "30%",
        "ê°€ì…ì—°ë ¹": "ìƒí›„ 2ê°œì›” ~ ë§Œ 8ì„¸"  # ì¶œì²˜: ì•„ì´í« ì„¤ëª… ì°¸ê³  :contentReference[oaicite:0]{index=0}
    },
    # ì˜ˆì‹œë¡œ ë‹¤ë¥¸ ë³´í—˜ì‚¬/ìƒí’ˆ ì¶”ê°€ ê°€ëŠ¥
    {
        "íšŒì‚¬": "í«ë¸”ë¦¬ (DBì†í•´ë³´í—˜)",
        "ë³´ì¥": "ì…ì› + ì™¸ê³¼ ìˆ˜ìˆ  ë³´ì¥ (ì˜ˆì‹œ)",
        "ìê¸°ë¶€ë‹´": "20%",
        "íŠ¹ì§•": "ìˆ˜ìˆ  íŠ¹ì•½ ê°€ëŠ¥"
    },
]

# ---------------------------------------------------------
# ë³‘ì› ë°ì´í„° (ìœ„ì¹˜ í¬í•¨)
# ---------------------------------------------------------
hospital_list = [
    {"name": "ì„œìš¸24ì‹œë™ë¬¼ë³‘ì›", "location": "ì„œìš¸", "special": "24ì‹œ"},
    {"name": "í•´ë°€ë™ë¬¼ë©”ë””ì»¬ì„¼í„°", "location": "ë¶€ì‚°", "special": "ë‚´ê³¼"},
    {"name": "ìˆ˜ì›ë™ë¬¼ë³‘ì›", "location": "ìˆ˜ì›", "special": "ì™¸ê³¼"},
    {"name": "ê°•ë‚¨ë™ë¬¼ë³‘ì›", "location": "ì„œìš¸", "special": "ì™¸ê³¼"},
    {"name": "ë¶€ì‚°ë™ë¬¼ë³‘ì›", "location": "ë¶€ì‚°", "special": "ì¢…í•©"},
    # â€¦ ë” ì¶”ê°€ ê°€ëŠ¥
]

# ---------------------------------------------------------
# ë°±ì‹  ìŠ¤ì¼€ì¤„ (ì˜ˆì‹œ)
# ---------------------------------------------------------
vaccination_data = {
    "í‘¸ë“¤": { "2": {"ë°±ì‹ ": "ì¢…í•©ë°±ì‹  1ì°¨", "ì„¤ëª…": "ê¸°ì´ˆì ‘ì¢… ì‹œì‘"}, "12": {"ë°±ì‹ ": "ê´‘ê²¬ë³‘", "ì„¤ëª…": "1ì°¨ ê´‘ê²¬ë³‘"} },
    "ë§í‹°ì¦ˆ": { "2": {"ë°±ì‹ ": "ì¢…í•©ë°±ì‹  1ì°¨", "ì„¤ëª…": "â€¦"}, "12": {"ë°±ì‹ ": "ê´‘ê²¬ë³‘", "ì„¤ëª…": "â€¦"} },
    # â€¦ í’ˆì¢…ë³„ë„ ê°€ëŠ¥í•˜ì§€ë§Œ ê°„ë‹¨íˆ ë†“ìŒ
}

# ---------------------------------------------------------
# í™ˆí™”ë©´ (ìŠ¤ë§ˆíŠ¸í° ìŠ¤íƒ€ì¼)
# ---------------------------------------------------------
if st.session_state.menu == "home":
    st.title("ğŸ¾ AI PET CARE")
    st.write("ì•„ë˜ ì•„ì´ì½˜ì„ ëˆŒëŸ¬ ê¸°ëŠ¥ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”")

    # ê·¸ë¦¬ë“œ ìŠ¤íƒ€ì¼ ë²„íŠ¼
    cols = st.columns(3)
    buttons = [
        ("ì…ì–‘ & í’ˆì¢… ì¶”ì²œ", "adopt"),
        ("ê±´ê°• ë£¨í‹´ ìº˜ë¦°ë”", "calendar"),
        ("ì¦ìƒ Q&A", "qa"),
        ("ë³‘ì› & ë³´í—˜ ë¹„êµ", "compare"),
        ("ì»¤ë®¤ë‹ˆí‹°", "community")
    ]
    for idx, (label, key) in enumerate(buttons):
        with cols[idx % 3]:
            if st.button(label):
                st.session_state.menu = key

# ---------------------------------------------------------
# ê¸°ëŠ¥ â‘ : ì…ì–‘ ì í•©ì„± & í’ˆì¢… ì¶”ì²œ
# ---------------------------------------------------------
elif st.session_state.menu == "adopt":
    st.header("ğŸ¶ ì…ì–‘ ì í•©ì„± & í’ˆì¢… ì¶”ì²œ")
    if st.button("ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°"):
        go_home()

    # ì…ë ¥
    work = st.selectbox("ê·¼ë¬´ ì‹œê°„", ["ì§§ìŒ", "ë³´í†µ", "ê¹€"])
    house = st.selectbox("ì£¼ê±° í˜•íƒœ", ["ì›ë£¸", "ì•„íŒŒíŠ¸", "ì£¼íƒ"])
    activity = st.selectbox("í™œë™ì„±", ["ë‚®ìŒ", "ë³´í†µ", "ë†’ìŒ"])
    budget = st.slider("ì›” ì˜ˆìƒ ì˜ˆì‚° (ë§Œì›)", 10, 200, 50)
    allergy = st.selectbox("ì•Œë ˆë¥´ê¸° ì—¬ë¶€", ["ì—†ìŒ", "ì•½í•¨", "ì‹¬í•¨"])
    noise = st.selectbox("ì†ŒìŒ í—ˆìš©ë„", ["ë‚®ìŒ", "ë³´í†µ", "ë†’ìŒ"])

    if st.button("ì¶”ì²œ ë°›ê¸°"):
        # ê·œì¹™ ê¸°ë°˜ í•„í„°
        breeds = ["í‘¸ë“¤", "ë§í‹°ì¦ˆ", "ì‹œë°”ê²¬", "ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„", "ë¯¹ìŠ¤ê²¬", "ë¹„ê¸€",
                  "í”„ë Œì¹˜ ë¶ˆë…", "ë‹¥ìŠ¤í›ˆíŠ¸", "ìš”í¬ì…” í…Œë¦¬ì–´", "ì¹˜ì™€ì™€", "ë³´ë” ì½œë¦¬",
                  "ì‹œì¶”", "í¬ë©”ë¼ë‹ˆì•ˆ", "ë¡œíŠ¸ì™€ì¼ëŸ¬", "ë¶ˆ í…Œë¦¬ì–´", "í‘¸ë“¤ ë¯¸ë‹ˆì–´ì²˜",
                  "ë³´ìŠ¤í„´ í…Œë¦¬ì–´", "ìŠˆë‚˜ìš°ì €", "ë‹¬ë§ˆì‹œì•ˆ", "ì…°í¼ë“œ", "ê¸°íƒ€"]
        filtered = []
        for b in breeds:
            if allergy == "ì‹¬í•¨" and b not in ["í‘¸ë“¤", "ê¸°íƒ€"]:
                continue
            if budget < 20 and b == "ì‹œë°”ê²¬":
                continue
            filtered.append(b)

        # ML ì ìˆ˜ ì˜ˆì‹œ (ë”ë¯¸)
        score = abs(len(work) + len(house) + len(activity) - (budget % 10))
        sorted_breeds = sorted(filtered, key=lambda x: abs(len(x) - score))
        best = sorted_breeds[:3]

        st.subheader("ğŸ“Œ ì¶”ì²œ í’ˆì¢… (1ë²ˆë¶€í„°)")
        for i, b in enumerate(best, start=1):
            st.write(f"{i}ë²ˆ: {b}")

        # ì²´í¬ë¦¬ìŠ¤íŠ¸
        st.subheader("ğŸ“¦ ì¤€ë¹„ë¬¼ ì²´í¬ë¦¬ìŠ¤íŠ¸")
        checklist_items = ["ì‚¬ë£Œ", "ë°°ë³€íŒ¨ë“œ", "ë¦¬ë“œì¤„", "ì¥ë‚œê°", "í•˜ìš°ìŠ¤"]
        # ì²´í¬ë°•ìŠ¤ + ìƒ‰ì¹  íš¨ê³¼
        for item in checklist_items:
            checked = st.checkbox(item, key=f"chk_{item}")
            if checked:
                st.markdown(f"<span style='color: green;'>âœ” {item}</span>", unsafe_allow_html=True)

        st.subheader("ğŸ“Š ì›” ì˜ˆìƒë¹„")
        st.write(f"{budget}ë§Œì› (Â±20%)")

# ---------------------------------------------------------
# ê¸°ëŠ¥ â‘¡: ê±´ê°• ë£¨í‹´ ìº˜ë¦°ë”
# ---------------------------------------------------------
elif st.session_state.menu == "calendar":
    st.header("ğŸ“… ê±´ê°• ë£¨í‹´ ìº˜ë¦°ë”")
    if st.button("ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°"):
        go_home()

    # ê°•ì•„ì§€ í’ˆì¢… ì„ íƒ (20ì¢… + ê¸°íƒ€)
    dog_breeds = ["í‘¸ë“¤", "ë§í‹°ì¦ˆ", "ì‹œë°”ê²¬", "ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„", "ë¯¹ìŠ¤ê²¬", "ë¹„ê¸€",
                  "í”„ë Œì¹˜ ë¶ˆë…", "ë‹¥ìŠ¤í›ˆíŠ¸", "ìš”í¬ì…” í…Œë¦¬ì–´", "ì¹˜ì™€ì™€", "ë³´ë” ì½œë¦¬",
                  "ì‹œì¶”", "í¬ë©”ë¼ë‹ˆì•ˆ", "ë¡œíŠ¸ì™€ì¼ëŸ¬", "ë¶ˆ í…Œë¦¬ì–´", "ë¯¸ë‹ˆì–´ì²˜ í‘¸ë“¤",
                  "ë³´ìŠ¤í„´ í…Œë¦¬ì–´", "ìŠˆë‚˜ìš°ì €", "ë‹¬ë§ˆì‹œì•ˆ", "ì…°í¼ë“œ"]
    species = st.selectbox("ì¢… (ê°•ì•„ì§€ ì¢…ë¥˜)", dog_breeds + ["ê¸°íƒ€"])
    age = st.number_input("ë‚˜ì´ (ê°œì›”)", 1, 240, 12)

    if st.button("ìŠ¤ì¼€ì¤„ ìƒì„±"):
        sd = vaccination_data.get(species, {})
        age_str = str(age)
        if age_str in sd:
            st.json(sd[age_str])
        else:
            st.info("í•´ë‹¹ ë‚˜ì´ì— ëŒ€í•œ ì ‘ì¢… ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")

    st.subheader("ğŸ“ˆ ì²´ì¤‘ / ë°°ë³€ ìƒíƒœ")
    weight = st.number_input("ì²´ì¤‘ (kg)", 0.1, 100.0)
    poop = st.selectbox("ë°°ë³€ ìƒíƒœ", ["ì •ìƒ", "ë¬´ë¦„", "ë”±ë”±í•¨", "í˜ˆë³€"])

    if st.button("ì´ìƒì¹˜ í™•ì¸"):
        if poop == "í˜ˆë³€":
            st.error("ğŸš¨ ì‘ê¸‰ ì‹ í˜¸: ì¦‰ì‹œ ë³‘ì› ë°©ë¬¸ í•„ìš”")
        elif weight < 1:
            st.warning("ì²´ì¤‘ì´ ë‚®ìŠµë‹ˆë‹¤. ì£¼ì˜í•´ì£¼ì„¸ìš”.")
        else:
            st.success("ì •ìƒ ë²”ìœ„ë¡œ ë³´ì…ë‹ˆë‹¤.")

# ---------------------------------------------------------
# ê¸°ëŠ¥ â‘¢: ì¦ìƒ Q&A (ì•ˆì‹¬ ê°€ì´ë“œ)
# ---------------------------------------------------------
elif st.session_state.menu == "qa":
    st.header("â“ ì¦ìƒ Q&A â€” ì•ˆì‹¬ ê°€ì´ë“œ")
    if st.button("ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°"):
        go_home()

    q = st.text_input("ì¦ìƒì´_
